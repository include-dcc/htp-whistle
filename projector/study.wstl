// Research Study 
// The research study acts as the Umbrella that covers all details associated with
// a single study. Currently, we treat all of DS-Connect as one study. Patients 
// are tied to a study by way of the ResearchSubject. 

// Definition: Build the ResearchStudy resource
//
// Argument:
//  study - This is the full study object created by Whistler
//
def Study(study) {
    title: study.title;
    description: study.desc;
    status: "completed"

    enrollment[0]: Reference_Key_Identifier(study, "Group", study.id);
    identifier[0]: Key_Identifier(study, "ResearchStudy", study.id);
    identifier[1].value: study.id;
    identifier[1].system:  "https://kf-api-dataservice.kidsfirstdrc.org/studies/";
    identifier[2].value (if study.accession?): study.accession;
    identifier[2].system (if study.accession?): "https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/study.cgi?study_id=";

    resourceType: "ResearchStudy";
}

// Portal team has asked that we provide a tag for the study to simplify
// their data pulls
def StudyMeta(study) {
    var study_identifier: Key_Identifier(study, "ResearchStudy", study.id);
    code: study.id;
    system: study_identifier.system;
}

// Description: Wrapper for all research studies in the dataset. For now, it's just the one
//
// Argument:
//  study - This is the full study object created by Whistler
def ProcessStudy(study) {
    out research_study: Study(study);
}
